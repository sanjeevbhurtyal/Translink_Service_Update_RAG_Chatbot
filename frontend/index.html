<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translink Service Update Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 800px;
            height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chat-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .chat-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .footer-note {
            font-size: 12px;  
            color: #666;
        }


        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f7f8fc;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.bot .message-bubble {
            background: white;
            color: #333;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
        }

        #userInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s;
        }

        #userInput:focus {
            border-color: #667eea;
        }

        #sendButton {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #sendButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #sendButton:active {
            transform: translateY(0);
        }

        #sendButton:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .chip {
            padding: 8px 16px;
            background: #f0f0f0;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chip:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .update-link {
            display: inline-block;
            margin-top: 8px;
            color: #667eea;
            text-decoration: none;
            font-size: 13px;
        }

        .update-link:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>üöå üöÜ TransitMate üöã ‚õ¥Ô∏è</h1>
            <p>Ask me about Translink service updates</p>
        </div>

        <div class="messages-container" id="messagesContainer">
            <div class="message bot">
                <div class="message-bubble">
                    Hi there! I‚Äôm TransitMate, your Translink service assistant. I‚Äôm here to help you stay up to date with the latest service changes. Ask me about any route, stop, or area and I‚Äôll guide you through it.
                    <div class="suggestion-chips">
                        <div class="chip" onclick="sendSuggestion('Are there any service impacts on the Gold Coast line?')">Gold Coast line status</div>
                        <div class="chip" onclick="sendSuggestion('Logan South updates')">Logan South</div>
                        <div class="chip" onclick="sendSuggestion('Major disruption on 26th May 2026')">Major disruption on 26th May</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <input 
                    type="text" 
                    id="userInput" 
                    placeholder="Ask about a route or stop..."
                    onkeypress="handleKeyPress(event)"
                />
                <button id="sendButton" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        // Configure your backend API URL here
        const API_URL = 'http://localhost:5000/chat';
        
        const messagesContainer = document.getElementById('messagesContainer');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');

        function addMessage(text, isUser = false, isError = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            
            if (isError) {
                bubbleDiv.innerHTML = `<div class="error-message">${text}</div>`;
            } else {
                bubbleDiv.innerHTML = text;
            }
            
            messageDiv.appendChild(bubbleDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
            
            typingDiv.appendChild(bubbleDiv);
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function linkify(text) {
            const urlRegex = /(https?:\/\/[^\s]+)/g;

            return text.replace(urlRegex, rawUrl => {
                // Remove trailing full stop if present
                let cleanUrl = rawUrl;
                let trailingDot = '';

                if (rawUrl.endsWith('.')) {
                    cleanUrl = rawUrl.slice(0, -1);  // remove the dot
                    trailingDot = '.';               // keep the dot in the text
                }

                return `<a href="${cleanUrl}" target="_blank" class="chat-link">${cleanUrl}</a>${trailingDot}`;
            });
        }


        async function sendMessage() {
            const message = userInput.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            userInput.value = '';
            
            // Disable input while processing
            sendButton.disabled = true;
            userInput.disabled = true;
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: message })
                });
                
                hideTypingIndicator();
                
                if (!response.ok) {
                    throw new Error('Failed to get response from server');
                }
                
                const data = await response.json();
                
                // Format response with links if relevant updates exist
                let botResponse = data.response;

                // Convert newlines to HTML line breaks
                botResponse = botResponse.replace(/\n\n/g, '<br><br>');
                botResponse = botResponse.replace(/\n/g, '<br>');

                // Force "More details:" to start on a new line
                botResponse = botResponse.replace(/More details:/g, '<br>More details:<br>');

                // Convert URLs to clickable links
                botResponse = linkify(botResponse);
                
                // Add footer to every bot message
                botResponse += '<br><br><span class="footer-note">For further updates, check the service updates page:<br><a href="https://translink.com.au/service-updates" target="_blank">https://translink.com.au/service-updates</a></span>';

                addMessage(botResponse, false);
                                
            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                addMessage(
                    'Sorry, I encountered an error. Please make sure the backend server is running at ' + API_URL,
                    false,
                    true
                );
            } finally {
                sendButton.disabled = false;
                userInput.disabled = false;
                userInput.focus();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }


        function sendSuggestion(text) {
            userInput.value = text;
            sendMessage();
        }

        // Focus input on load
        userInput.focus();
    </script>
</body>
</html>